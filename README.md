# Automatic Phased-Array Ultrasonic Detection System

该仓库包含一个基于 **Qt 5.12.12** 的 Windows 应用，用于控制伺服运动并驱动
PA22s 超声探伤仪，实现自动化相控阵超声检测。项目内大部分代码带有中文注释，
源文件采用本地编码（通常为 **GBK**），在非中文环境查看时可能出现乱码。

## 项目结构

```
├── 602/                 Qt 项目目录（Visual Studio 工程）
│   ├── *.cpp / *.h      应用源码，主要模块见下文
│   ├── QtMsBuild/       Qt 与 Visual Studio 的集成脚本
│   ├── LTDMC.dll/lib    伺服控制库
│   ├── PVT.dll          伺服运动相关库
│   └── 开发笔记.txt       简单的开发记录
├── requirements.txt     第三方依赖简要列表
└── README.md            项目说明（本文件）
```

## 主要模块

- **Motioncontrol** – 调用 `LTDMC` 库控制各轴运动，提供点动、速度运动、
  自动扫描等接口。
- **Pa22scontrol** – 负责与 PA22s 仪器通过 TCP 进行命令和数据通信。
- **DataProcess** – 处理 A/B/C 扫数据并生成图像，支持门控、编码器位置获取等。
- **DataSave** – 将扫描数据及图片保存到本地文件。
- **MainWindow** – Qt 主界面，整合运动控制、参数设置、数据显示及保存功能。

部分模块的实现仍较为粗糙，可根据实际需要自行扩展或重构。

## 构建方法

1. 安装 **Qt 5.12.12 (msvc2017_64)** 并确保在 Visual Studio 中配置好
   `QtMsBuild`。项目文件已预设需要 `charts`、`core`、`gui`、`network`、
   `serialbus`、`serialport`、`widgets` 等模块。
2. 打开 `602/602_ui_02-0703_817调试.sln`（Visual Studio 2017 或兼容版本）。
3. 根据需要切换到 `Debug` 或 `Release` 构建配置后直接编译运行。
4. 若缺少伺服控制库 (`LTDMC.dll`、`PVT.dll`)，请将其放置在可执行文件同目录下。 

## 使用说明

启动程序后，可在主界面中进行以下操作（根据实际 UI 可能略有差异）：

1. **连接 PA22s** – 设置 IP 与端口后连接设备，查看连接状态。
2. **设置扫描参数** – 包括阵列通道数、步距、孔径、聚焦角等。
3. **控制伺服运动** – 选择轴向、速度或扫描路径，开始或停止运动。
4. **实时查看 B/C 扫** – 数据采集线程会刷新 B 扫与 C 扫图像，可调整色阶。
5. **保存数据** – 采集到的数据和图像可保存为二进制文件或图片文件。

## 编码说明

源代码文件保存为 GBK 等本地编码，若在 UTF‑8 环境下出现中文乱码，
请使用支持 GBK 的编辑器打开或批量转换编码。

## TODO / 模板

- **单元测试** – 当前没有自动化测试，可使用 Qt Test 编写基本单元测试模版。
- **多语言支持** – 若需要英文界面，可使用 Qt 的 `tr()` 与翻译文件机制。
- **文档完善** – 可进一步补充模块间数据流、通信协议等详细文档。

